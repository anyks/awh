#!/bin/sh

# Отладочный вывод
echo "[$(date)] postinstall-awh started (PID: $$)" >> /tmp/postinstall-awh.log
echo "CWD: $(pwd)" >> /tmp/postinstall-awh.log
echo "Arguments: $*" >> /tmp/postinstall-awh.log
echo "PATH: $PATH" >> /tmp/postinstall-awh.log
echo "--- Environment ---" >> /tmp/postinstall-awh.log
env >> /tmp/postinstall-awh.log 2>&1
echo "===================" >> /tmp/postinstall-awh.log

# Экспортируем все существующие пути где могут лежать приложения
export PATH="/usr/bin:/usr/local/bin:/opt/local/bin:$PATH"

# Получаем название скрипта
readonly NAME=$0
# Получаем корневую дирректорию
readonly ROOT=$(cd "$(dirname "$0")" && pwd)
# CMake адрес
readonly CMAKE=$(cmake --system-information | grep CMAKE_ROOT | cut -d= -f2 | awk '{print $2}' | sed "s/^\([\"']\)\(.*\)\1\$/\2/g")
# Адрес размещения файла CMake
readonly CMAKE_PATH_AWH="/usr/share/awh/cmake"

# Если адрес файла CMake существует
if [ -f "$CMAKE_PATH_AWH/FindAWH.cmake" ]; then
	# Выводим сообщение, что мы запустили процесс регистрации
	echo "Process registration CMake started"
	# Перемещаем CMake файл в нужный нам каталог
	cp $CMAKE_PATH_AWH/FindAWH.cmake "$CMAKE/Modules"/
	# Выводим сообщение, что мы завершили процесс регистрации
	echo "Process registration CMake finished"
fi

# Завершаем установку
exit 0
